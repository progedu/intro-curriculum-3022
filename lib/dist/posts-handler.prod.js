"use strict";var pug=require("pug"),util=require("./handler-util"),Post=require("./post");function handle(t,n){switch(t.method){case"GET":n.writeHead(200,{"Content-Type":"text/html; charset=utf-8"}),Post.findAll({order:[["id","DESC"]]}).then(function(e){n.end(pug.renderFile("./views/posts.pug",{posts:e}))});break;case"POST":var o=[];t.on("data",function(e){o.push(e)}).on("end",function(){o=Buffer.concat(o).toString();var e=decodeURIComponent(o).split("content=")[1];console.info("投稿されました: "+e),Post.create({content:e,trackingCookie:null,postedBy:t.user}).then(function(){handleRedirectPosts(t,n)})});break;default:util.handleBadRequest(t,n)}}function handleRedirectPosts(e,t){t.writeHead(303,{Location:"/posts"}),t.end()}module.exports={handle:handle};